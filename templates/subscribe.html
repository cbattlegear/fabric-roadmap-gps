{% extends 'base.html' %}
{% block title %}Email Notifications - Fabric GPS{% endblock %}
{% block extra_head %}
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🗺️%3C/text%3E%3C/svg%3E">
<style>
.subscription-section{max-width:600px;margin:0 auto;padding:var(--spacing-xl) 0;}
.subscription-benefits{margin-top:var(--spacing-l);padding:var(--spacing-l);background:var(--color-background);border-radius:8px;border-left:4px solid var(--color-primary);} 
.subscription-benefits h4{margin-top:0;color:var(--color-primary);} 
.subscription-benefits ul{margin:var(--spacing-m) 0 0 0;padding-left:var(--spacing-l);} 
.subscription-benefits li{margin-bottom:var(--spacing-s);color:var(--color-text-secondary);} 
.email-input{flex:1;min-width:200px;} 
.subscription-form{display:flex;gap:var(--spacing-m);margin:var(--spacing-l) 0;} 
@media (max-width:768px){.subscription-form{flex-direction:column;}.email-input{min-width:auto;}}
</style>
{% endblock %}
{% block herotitle%}Email Notifications{% endblock %}
{% block herosubtitle%}
Stay informed about the latest Microsoft Fabric roadmap updates. Get weekly email summaries delivered straight to your inbox.
{% endblock %}
{% block content %}
<div class="container">
    <div class="subscription-section">
        <div class="card">
            <h3>Weekly Email Updates</h3>
            <p>Subscribe to receive weekly summaries of new roadmap items and updates.</p>
            <div class="subscription-item">
                <div class="subscription-form">
                    <input type="email" id="email-input" placeholder="Enter your email address" class="email-input" />
                    <button id="subscribe-btn" class="btn btn-primary">Subscribe</button>
                </div>
                <div id="subscription-message" class="subscription-message"></div>
            </div>
            <div class="subscription-benefits">
                <h4>What you'll receive:</h4>
                <ul>
                    <li>Weekly summaries of new and updated roadmap items</li>
                    <li>Zero junk mail</li>
                    <li>Easy unsubscribe option in every email</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
class EmailSubscription{constructor(){this.emailInput=document.getElementById('email-input');this.subscribeBtn=document.getElementById('subscribe-btn');this.messageDiv=document.getElementById('subscription-message');this.bindEvents();}
bindEvents(){this.subscribeBtn.addEventListener('click',()=>this.subscribe());this.emailInput.addEventListener('keypress',e=>{if(e.key==='Enter'){this.subscribe();}});} 
async subscribe(){const email=this.emailInput.value.trim();if(!this.validateEmail(email)){this.showMessage('Please enter a valid email address.','error');return;}this.setLoading(true);try{const response=await fetch('/api/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});const result=await response.json();if(response.ok){this.showMessage(result.message,'success');this.emailInput.value='';}else{this.showMessage(result.error||'An error occurred. Please try again.','error');}}catch(err){this.showMessage('Network error. Please try again.','error');}finally{this.setLoading(false);}}
validateEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);} 
showMessage(m,t){this.messageDiv.textContent=m;this.messageDiv.className=`subscription-message ${t}`;this.messageDiv.style.display='block';}
setLoading(l){this.subscribeBtn.disabled=l;this.subscribeBtn.textContent=l?'Subscribing...':'Subscribe';this.emailInput.disabled=l;}}

document.addEventListener('DOMContentLoaded',()=>{new EmailSubscription();});
</script>
{% endblock %}
